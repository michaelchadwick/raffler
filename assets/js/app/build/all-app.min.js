"use strict";function _toArray(e){return Array.isArray(e)?e:Array.from(e)}if((Raffler={}).initDataFile="./assets/json/raffler_data.json",Raffler.initOptionsFile="./assets/json/raffler_options.json",Raffler.initLogoFile=null,Raffler.initLogoLink=null,Raffler.userOptionsMerge=!1,Raffler.userOptionsPath="./assets/json/raffler_user_options.json",Raffler.userOptionsMerge?$.getJSON(Raffler.userOptionsPath,function(e){}).done(function(e){Raffler.userDataFile=e.userDataFile,Raffler.userLogoFile=e.userLogoFile,Raffler.userLogoLink=e.userLogoLink,Raffler.dataFilePath=Raffler.userDataFile||Raffler.initDataFile,Raffler.logoFilePath=Raffler.userLogoFile||Raffler.initLogoFile,Raffler.logoFileLink=Raffler.userLogoLink||Raffler.initLogoLink}).fail(function(){Raffler.dataFilePath=Raffler.initDataFile}):Raffler.dataFilePath=Raffler.initDataFile,Raffler.itemsArr=[],Raffler.itemsLeftArr=[],Raffler.initOptionsObj={showGraph:!1,boxResize:!1,soundCountdown:!0,soundVictory:!1},Raffler.initItemsObj=[],Raffler.initInterval=25,Raffler.initMult=1,Raffler.initTimesRun=0,Raffler.lastInterval=359,Raffler.hasLocalStorage=!0,Raffler.shouldIgnoreSound=!1,Raffler.lastItemChosen="",Raffler.lastItemChosenConfirmed=!1,Raffler.stages={INIT:0,BEGUN:1,SLOWED:2,SLOWEST:3,DONE:4},Raffler.body=$("body"),Raffler.title=$("header"),Raffler.divItemStatusBubble=$("div#item-status-bubble"),Raffler.divAdminMenu=$("div#admin-menu"),Raffler.divMainWrapper=$("div#wrapper"),Raffler.divItemsCycle=$("div#items-cycle"),Raffler.divItemsGraph=$("div#items-graph"),Raffler.divResultsWrapper=$("div#results-wrapper"),Raffler.divResultsCount=$("div#results-wrapper h3 span"),Raffler.divResultsContent=$("div#results-wrapper div ul"),Raffler.divDataResetDialog=$("div#data-reset-dialog"),Raffler.divUserItemsManager=$("div#user-items-manager"),Raffler.divUserItemsDisplay=$("div#user-items-display"),Raffler.divUserItemsClearDialog=$("div#user-items-clear-dialog"),Raffler.btnAdminMenuToggle=$("span#button-admin-menu-toggle"),Raffler.btnTestSuccess=$("a#button-test-success"),Raffler.btnTestNotice=$("a#button-test-notice"),Raffler.btnTestWarning=$("a#button-test-warning"),Raffler.btnTestError=$("a#button-test-error"),Raffler.btnTimerStart=$("a#button-timer-start"),Raffler.btnTimerStop=$("a#button-timer-stop"),Raffler.btnDataReset=$("a#button-data-reset"),Raffler.btnUserItemsAdd=$("button#button-user-items-add"),Raffler.btnUserItemsClear=$("button#button-user-items-clear"),Raffler.btnRaffle=$("a#button-raffle"),Raffler.divChosenConfirm=$("div#winner-confirm"),Raffler.btnChosenConfirmYes=$("button#button-confirm-yes"),Raffler.btnChosenConfirmNo=$("button#button-confirm-no"),Raffler.btnExportResults=$("div#results-wrapper div button"),Raffler.ckOptShowGraph=$("input#check-option-show-graph"),Raffler.ckOptResize=$("input#check-option-resize"),Raffler.ckOptSoundCountdown=$("input#check-option-sound-countdown"),Raffler.ckOptSoundVictory=$("input#check-option-sound-winner"),Raffler.ckOptFireworks=$("input#check-option-fireworks"),Raffler.inputUserItemsAddName=$("input#text-user-items-add-name"),Raffler.inputUserItemsAddAffl=$("input#text-user-items-add-affl"),Raffler.textAvailableItems=$("div#items-available textarea"),Raffler.textAvailableItemsCount=$("div#items-available .title span"),Raffler.textChosenItems=$("div#items-chosen textarea"),Raffler.textChosenItemsCount=$("div#items-chosen .title span"),Raffler.sndBeep=$("audio#beep"),Raffler.sndVictory=$("audio#victory"),Raffler.divStageValue=$("div#stage-value span"),Raffler.divIntervalValue=$("div#interval-value span"),Raffler.divIntervalRange=$("div#interval-value input[type=range]"),Raffler.divMultiplyValue=$("div#multiply-value span"),Raffler.divTimesRunValue=$("div#timesrun-value span"),Raffler.ckOptResize.is(":checked")||(Raffler.body.removeClass(),Raffler.body.addClass("level4"),Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level4")),Raffler.sndBeep.attr("src","./assets/audio/beep.mp3"),Raffler.sndVictory.attr("src","./assets/audio/victory.mp3"),$.QueryString=function(e){if(""===e)return{};for(var t={},a=0;a<e.length;++a){var r=e[a].split("=",2);2===r.length&&(t[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&")),Raffler._disableRaffle=function(){Raffler.body.removeClass(),Raffler.btnRaffle.prop("disabled",!0),Raffler.btnRaffle.addClass("disabled")},Raffler._enableRaffle=function(){Raffler.btnRaffle.removeClass("disabled"),Raffler.btnRaffle.prop("disabled",!1)},Raffler._disableTimerStart=function(){Raffler.btnTimerStart.prop("disabled",!0),Raffler.btnTimerStart.addClass("disabled")},Raffler._enableTimerStart=function(){Raffler.btnTimerStart.prop("disabled",!1),Raffler.btnTimerStart.removeClass("disabled")},Raffler._disableTimerStop=function(){Raffler.btnTimerStop.prop("disabled",!0),Raffler.btnTimerStop.addClass("disabled")},Raffler._enableTimerStop=function(){Raffler.btnTimerStop.prop("disabled",!1),Raffler.btnTimerStop.removeClass("disabled")},Raffler._disableChosenConfirm=function(){Raffler.divChosenConfirm.hide(),Raffler.btnChosenConfirmYes.addClass("disabled"),Raffler.btnChosenConfirmNo.addClass("disabled"),Raffler.btnChosenConfirmYes.prop("disabled",!0),Raffler.btnChosenConfirmNo.prop("disabled",!0),Raffler._enableTimerStop()},Raffler._enableChosenConfirm=function(){Raffler.divChosenConfirm.show(),Raffler.btnChosenConfirmYes.removeClass("disabled"),Raffler.btnChosenConfirmNo.removeClass("disabled"),Raffler.btnChosenConfirmYes.prop("disabled",!1),Raffler.btnChosenConfirmNo.prop("disabled",!1),Raffler._disableTimerStart(),Raffler._disableTimerStop()},Raffler._sanitize=function(e){return $.each(e,function(e,t){t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/""/g,"&quot;")}),e},Raffler._isDuplicateValue=function(e){var t=Raffler._getLocalStorageItem("rafflerUserItems"),a=!1;return $.each(t,function(t,r){e.name===r.name&&e.affl===r.affl&&(a=!0)}),a},Raffler._shuffleArray=function(e){for(var t=e.length-1;t>0;t--){var a=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[a],e[a]=r}},Raffler._getLocalStorageItem=function(e){try{return JSON.parse(window.localStorage.getItem(e))}catch(e){return console.error("_getLocalStorageItem: "+e),!1}},Raffler._setLocalStorageItem=function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){return console.error("_setLocalStorageItem: "+e),!1}},Raffler._notify=function(e,t,a){t=void 0===t?"":t,a=void 0===a?"":a;var r,f,l,s=1500;switch(t){case"success":r="#4c8504",f="#ffffff",l="Success",s=4e3;break;case"warning":r="#c1bf24",f="#000000",l="Warning",s=6e3;break;case"error":r="#880000",f="#ffffff",l="Error",s=0;break;default:r="#e6e1d0",f="#000000",l="Notice",s=4e3}if(console.log.apply(console,function(e){var t=_toArray(e.split(" ")),a=t[0],r=t[1];return["%c"+t[2]+"%c "+t.slice(3).join(" "),"background-color: "+a+"; border-right: 3px solid #000; color: "+r+"; padding: 0.15em 0.35em 0.15em 0.5em",""]}(r+" "+f+" "+l.toUpperCase()+" "+e)),a){var n=document.createElement("div");$(n).addClass("item-status").css({"background-color":r,color:f}).html("<strong>"+l+"</strong>: "+e).prependTo(".main-container").click(function(){$(this).remove()}),s>0?$(n).hide().fadeToggle(500).delay(s).fadeToggle(200).queue(function(){$(this).remove()}):$(n).hide().fadeToggle(500)}},Raffler._playSound=function(e){var t=document.getElementById(e);t?("beep"===e&&Raffler.ckOptSoundCountdown.is(":checked")&&t.play(),"victory"===e&&Raffler.ckOptSoundVictory.is(":checked")&&t.play()):Raffler._notify("Sound file not found or is invalid","warning"),Raffler.shouldIgnoreSound&&(Raffler.shouldIgnoreSound=!1)},void 0===Raffler)var Raffler={};Raffler.initApp=function(){void 0!==$.QueryString.admin&&Raffler.btnAdminMenuToggle.show(),Raffler.userOptionsMerge&&void 0!==Raffler.logoFilePath&&void 0!==Raffler.logoFileLink&&Raffler.title.append("<span>at</span><a href='"+Raffler.logoFileLink+"' target='_blank'><img src='"+Raffler.logoFilePath+"' /></a>"),Raffler.setEventHandlers(),Raffler.checkForLocalStorage(),Raffler.resetApp(),Raffler.refreshDebugValues(),Raffler.refreshItemsGraph(Raffler.itemsLeftArr),Raffler._getLocalStorageItem("rafflerChosenItems").length&&(Raffler.refreshChosenItemsDisplay(),Raffler.divResultsWrapper.show()),Raffler.divIntervalValue.text(Raffler.divIntervalRange.val()),Raffler._disableTimerStart(),Raffler.btnRaffle.focus()},Raffler.setEventHandlers=function(){Raffler.btnAdminMenuToggle.click(function(){$(this).toggleClass("button-open"),Raffler.divAdminMenu.toggleClass("menu-show")}),Raffler.divIntervalRange.on("change",function(e){e.preventDefault(),Raffler.divIntervalValue.text($(this).val()),window.countdownTimer.interval=parseInt($(this).val())}),Raffler.ckOptShowGraph.on("change",function(e){Raffler.divItemsGraph.toggle();var t=Raffler._getLocalStorageItem("rafflerOptions");t.showGraph=!t.showGraph,Raffler._setLocalStorageItem("rafflerOptions",t)}),Raffler.ckOptResize.on("change",function(e){var t=Raffler._getLocalStorageItem("rafflerOptions");t.boxResize=!t.boxResize,Raffler._setLocalStorageItem("rafflerOptions",t)}),Raffler.ckOptSoundCountdown.on("change",function(e){var t=Raffler._getLocalStorageItem("rafflerOptions");t.soundCountdown=!t.soundCountdown,Raffler._setLocalStorageItem("rafflerOptions",t)}),Raffler.ckOptSoundVictory.on("change",function(e){var t=Raffler._getLocalStorageItem("rafflerOptions");t.soundVictory=!t.soundVictory,Raffler._setLocalStorageItem("rafflerOptions",t)}),Raffler.btnTestSuccess.click(function(e){e.preventDefault(),Raffler._notify("test success that is long enough to actually go onto a second line because of width and such and thus.","success",!0)}),Raffler.btnTestNotice.click(function(e){e.preventDefault(),Raffler._notify("test notice that is long enough to actually go onto a second line because of width and such and thus.","notice",!0)}),Raffler.btnTestWarning.click(function(e){e.preventDefault(),Raffler._notify("test notice that is long enough to actually go onto a second line because of width and such and thus.","warning",!0)}),Raffler.btnTestError.click(function(e){e.preventDefault(),Raffler._notify("test notice that is long enough to actually go onto a second line because of width and such and thus.","error",!0)}),Raffler.btnTimerStart.click(function(e){e.preventDefault(),Raffler.btnTimerStart.prop("disabled",!1)&&(window.countdownTimer.start(),Raffler.divItemsCycle.removeClass("stopped"),Raffler._disableTimerStart(),Raffler._enableTimerStop())}),Raffler.btnTimerStop.click(function(e){e.preventDefault(),Raffler.btnTimerStop.prop("disabled",!1)&&(window.countdownTimer.stop(),Raffler.divItemsCycle.addClass("stopped"),Raffler._disableTimerStop(),Raffler._enableTimerStart())}),Raffler.btnDataReset.click(function(e){e.preventDefault(),Raffler.divDataResetDialog.dialog({autoOpen:!1,modal:!0,resizeable:!1,height:"auto",buttons:{"Reset it!":function(){Raffler.resetCountdown(),$(this).dialog("close")},"Nevermind.":function(){$(this).dialog("close")}}}),Raffler.divDataResetDialog.dialog("open")}),Raffler.inputUserItemsAddName.keyup(function(e){13===e.which&&(e.preventDefault(),Raffler.btnUserItemsAdd.click())}),Raffler.inputUserItemsAddAffl.keyup(function(e){13===e.which&&(e.preventDefault(),Raffler.btnUserItemsAdd.click())}),Raffler.btnUserItemsAdd.click(function(){if(""!==Raffler.inputUserItemsAddName.val()&&""!==Raffler.inputUserItemsAddAffl.val()){var e={name:Raffler.inputUserItemsAddName.val().trim(),affl:Raffler.inputUserItemsAddAffl.val().trim()};if("undefined"!==e){var t=Raffler._getLocalStorageItem("rafflerUserItems"),a=!1;Raffler._isDuplicateValue(e)?Raffler._notify('user item "'+e.name+" ("+e.affl+')" not added: duplicate.',"error",!0):(t.push(Raffler._sanitize(e)),a=!0,Raffler.btnUserItemsClear.prop("disabled",!1),Raffler.btnUserItemsClear.removeClass()),a&&(Raffler._setLocalStorageItem("rafflerUserItems",t),Raffler._notify('user item "'+e.name+" ("+e.affl+')" added!',"success",!0),Raffler.clearUserItemsInput(),Raffler.syncUserItemsWithItemsArr())}}}),Raffler.btnUserItemsClear.click(function(e){e.preventDefault();try{Raffler._getLocalStorageItem("rafflerUserItems").length>0&&(Raffler.btnUserItemsClear.prop("disabled",!1),Raffler.btnUserItemsClear.removeClass(),Raffler.divUserItemsClearDialog.dialog({autoOpen:!1,modal:!0,resizeable:!1,height:"auto",buttons:{"Clear them!":function(){Raffler.resetUserItems(),Raffler.clearUserItemsInput(),Raffler.btnUserItemsClear.prop("disabled",!0),Raffler.btnUserItemsClear.addClass("disabled"),$(this).dialog("close")},"Nevermind.":function(){$(this).dialog("close")}}}),Raffler.divUserItemsClearDialog.dialog("open"))}catch(e){Raffler._notify("btnUserItemsClear: "+e,"error")}}),Raffler.btnRaffle.click(function(e){e.preventDefault(),Raffler.btnRaffle.prop("disabled")||Raffler.raffleButtonSmash()}),Raffler.btnChosenConfirmYes.click(function(e){Raffler.lastItemChosenConfirmed=!0,Raffler.continueRaffling()}),Raffler.btnChosenConfirmNo.click(function(e){Raffler.lastItemChosenConfirmed=!1,Raffler.continueRaffling()}),Raffler.btnExportResults.click(function(e){e.preventDefault();var t=$("div#results-wrapper div ul").html().replace(/<li>/g,"").replace(/<\/li>/g,"\r\n"),a=new(0,window.Blob)([t],{type:"text/plain;charset="+document.characterSet}),r=new Date,f=r.getFullYear(),l=r.getMonth()+1;l=l<10?"0"+l:""+l;var s=r.getDate(),n=""+f+l+(s=s<10?"0"+s:""+s),i=r.getHours();i=i<10?"0"+i:""+i;var o=r.getMinutes();o=o<10?"0"+o:""+o;var d=r.getSeconds(),R="raffler-export_"+n+"_"+(i+":"+o+":"+(d=d<10?"0"+d:""+d))+".txt";window.saveAs(a,R)})},Raffler.checkForLocalStorage=function(){try{var e=void 0!==window.localStorage,t=void 0!==window.sessionStorage;e||t?(window.localStorage.getItem("rafflerOptions")?Raffler._notify("checkForLocalStorage: rafflerOptions already exists","notice"):Raffler._setLocalStorageItem("rafflerOptions",Raffler.initOptionsObj),Raffler.syncOptionsToUI(),window.localStorage.getItem("rafflerUserItems")?Raffler._notify("checkForLocalStorage: rafflerUserItems already exists","notice"):Raffler._setLocalStorageItem("rafflerUserItems",Raffler.initItemsObj),window.localStorage.getItem("rafflerChosenItems")?Raffler._notify("checkForLocalStorage: rafflerChosenItems already exists","notice"):Raffler._setLocalStorageItem("rafflerChosenItems",Raffler.initItemsObj)):(Raffler.hasLocalStorage=!1,Raffler.divUserItemsManager.hide(),Raffler._notify("No localStorage or sessionStorage support, so no user items or saving of chosen items. Please don't reload!","error",!0))}catch(e){Raffler.hasLocalStorage=!1,Raffler.divUserItemsManager.hide(),Raffler._notify("No localStorage or sessionStorage support, so no user items or saving of chosen items. Please don't reload!","error",!0)}},Raffler.resetApp=function(){Raffler.initItemsArr(),Raffler.lastItemChosen="",Raffler.timesRun=Raffler._getLocalStorageItem("rafflerChosenItems").length,Raffler.divIntervalRange.val(Raffler.initInterval),Raffler.refreshAvailableItemsDisplay(),Raffler.refreshResultsCount(),Raffler.refreshDebugValues()},Raffler.resetCountdown=function(){Raffler.ckOptResize.is(":checked")?Raffler.divItemsCycle.removeClass():(Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level4")),Raffler.resetApp(),Raffler.resetChosenItems(),Raffler.resetUserItems(),Raffler.divResultsContent.text(""),Raffler.clearUserItemsInput(),Raffler.textAvailableItems.text(""),Raffler.textChosenItems.text(""),Raffler.divResultsWrapper.hide(),Raffler._enableRaffle(),window.countdownTimer.startCountdown=!1,window.countdownTimer.interval=Raffler.initInterval,window.countdownTimer.mult=Raffler.initMult,window.countdownTimer.stage=Raffler.stages.INIT,window.countdownTimer.start(),Raffler.timesRun=0,Raffler.refreshDebugValues()},Raffler.resetChosenItems=function(){try{Raffler._setLocalStorageItem("rafflerChosenItems",Raffler.initItemsObj),Raffler.refreshChosenItemsDisplay(),Raffler._notify("resetChosenItems: reset","warning")}catch(e){Raffler._notify("resetChosenItems: "+e,"error")}},Raffler.resetUserItems=function(){try{for(var e=Raffler._getLocalStorageItem("rafflerUserItems"),t=0;t<Raffler.itemsArr.length;t++)for(var a=0;a<e.length;a++)Raffler.itemsArr[t].name===e[a].name&&Raffler.itemsArr[t].affl===e[a].affl&&Raffler.itemsArr.splice(t,1)[0];Raffler._setLocalStorageItem("rafflerUserItems",Raffler.initItemsObj),Raffler.refreshUserItemsDisplay(),Raffler.refreshAvailableItemsDisplay(),Raffler._notify("User items reset","success",!0)}catch(e){Raffler._notify("resetUserItems: "+e,"error")}},Raffler.clearUserItemsInput=function(){Raffler.inputUserItemsAddName.val(""),Raffler.inputUserItemsAddAffl.val("")},Raffler.initItemsArr=function(){$.getJSON(Raffler.dataFilePath,function(e){}).done(function(e){for(;Raffler.itemsArr.length;)Raffler.itemsArr.pop();Raffler.itemsArr.length=0,Raffler.itemsArr&&($.each(e,function(e,t){Raffler.itemsArr.push(t)}),Raffler._shuffleArray(Raffler.itemsArr),Raffler.itemsLeftArr=Raffler.itemsArr,Raffler.refreshItemsGraph(Raffler.itemsLeftArr),Raffler.syncChosenItemsWithItemsArr(),Raffler.syncUserItemsWithItemsArr())}).fail(function(e,t,a){Raffler._notify("Failed initial data load: "+a,"error",!0)})},Raffler.syncOptionsToUI=function(){var e=Raffler._getLocalStorageItem("rafflerOptions");e.showGraph?(Raffler.ckOptShowGraph.prop("checked",!0),Raffler.divItemsGraph.show()):(Raffler.ckOptShowGraph.prop("checked",!1),Raffler.divItemsGraph.hide()),e.boxResize?Raffler.ckOptResize.prop("checked",!0):Raffler.ckOptResize.prop("checked",!1),e.soundCountdown?Raffler.ckOptSoundCountdown.prop("checked",!0):Raffler.ckOptSoundCountdown.prop("checked",!1),e.soundVictory?Raffler.ckOptSoundVictory.prop("checked",!0):Raffler.ckOptSoundVictory.prop("checked",!1)},Raffler.syncChosenItemsWithItemsArr=function(){try{var e=Raffler.itemsArr,t=Raffler._getLocalStorageItem("rafflerChosenItems");if(t&&t.length>0){for(var a=0;a<t.length;a++)for(var r=0;r<e.length;r++)t[a].name===e[r].name&&t[a].affl===e[r].affl&&e.splice(r,1)[0];Raffler.itemsLeftArr=e,Raffler.refreshItemsGraph(Raffler.itemsLeftArr)}0===e.length&&(window.countdownTimer.stop(),Raffler._disableRaffle(),Raffler.divItemsCycle.html("<div>:'(<br /><br />Nothing to raffle!</div>"),Raffler.body.addClass("level4"),Raffler._notify("syncChosenItemsWithItemsArr: all items chosen","warning"))}catch(e){Raffler._notify("syncChosenItemsWithItemsArr: "+e,"error")}},Raffler.syncUserItemsWithItemsArr=function(){try{var e=Raffler.itemsArr,t=Raffler._getLocalStorageItem("rafflerUserItems"),a=!0;if(t&&t.length>0){Raffler.btnUserItemsClear.prop("disabled",!1),Raffler.btnUserItemsClear.removeClass();for(var r=0;r<t.length;r++){for(var f=0;f<e.length;f++)t[r].name===e[f].name&&t[r].affl===e[f].affl&&(a=!1);a&&Raffler.itemsArr.push(t[r])}Raffler.refreshUserItemsDisplay(),Raffler._notify("syncUserItemsWithItemsArr: synced","notice")}Raffler.refreshAvailableItemsDisplay()}catch(e){Raffler._notify("syncUserItemsWithItemsArr: "+e,"error")}},Raffler.refreshItemsGraph=function(e){var t=0;Raffler.divItemsGraph.html(""),e.forEach(function(e){Raffler.divItemsGraph.append("<span id="+t+++"></span>")})},Raffler.refreshDebugValues=function(){Raffler.divStageValue.text(window.countdownTimer.stage),Raffler.divIntervalValue.text(window.countdownTimer.interval),Raffler.divIntervalRange.val(window.countdownTimer.interval),Raffler.divMultiplyValue.text(window.countdownTimer.mult),Raffler.divTimesRunValue.text(Raffler.timesRun)},Raffler.refreshResultsCount=function(){Raffler.divResultsCount.text(Raffler._getLocalStorageItem("rafflerChosenItems").length)},Raffler.refreshChosenItemsDisplay=function(){try{var e=Raffler._getLocalStorageItem("rafflerChosenItems");if(e&&e.length>0){var t=1;Raffler.textChosenItems.text(""),Raffler.divResultsContent.text(""),Raffler.divResultsWrapper.show(),$.each(e,function(e,a){Raffler.divResultsContent.prepend("<li>"+t+++". "+a.name+" ("+a.affl+")</li>"),Raffler.textChosenItems.prepend(a.name+" ("+a.affl+")\n")}),Raffler.textChosenItemsCount.text("("+e.length+")"),Raffler._notify("refreshChosenItemsDisplay: display updated")}else Raffler.textChosenItems.text(""),Raffler._notify("refreshChosenItemsDisplay: none to display","warning")}catch(e){Raffler._notify("refreshChosenItemsDisplay: "+e,"error")}},Raffler.refreshUserItemsDisplay=function(){try{var e=Raffler._getLocalStorageItem("rafflerUserItems");e&&e.length>0?$.each(e,function(e,t){Raffler.divUserItemsDisplay.children().append("<li>"+t.name+" ("+t.affl+")</li>")}):(Raffler.divUserItemsDisplay.html(""),Raffler._notify("refreshUserItemsDisplay: none to display"))}catch(e){Raffler._notify("refreshUserItemsDisplay: "+e,"error")}},Raffler.refreshAvailableItemsDisplay=function(){Raffler.textAvailableItems.text(""),Raffler.itemsArr.forEach(function(e){Raffler.textAvailableItems.prepend(e.name+" ("+e.affl+")\n")}),Raffler.textAvailableItemsCount.text("("+Raffler.itemsArr.length+")")},Raffler.addChosenItemToLocalStorage=function(e){try{var t=Raffler._getLocalStorageItem("rafflerChosenItems");t.push(e),Raffler._setLocalStorageItem("rafflerChosenItems",t),Raffler.refreshAvailableItemsDisplay()}catch(e){Raffler._notify("addChosenItemToLocalStorage: "+e,"error")}},Raffler.timer=function(e,t){if(Raffler.itemsArr){var a={items:Raffler.itemsArr,mult:Raffler.initMult,stage:0,interval:t,callback:e,stopped:!1,startCountdown:!1,index:Math.floor(Math.random()*Raffler.itemsArr.length),runLoop:function(){if(!a.stopped){var e=a.callback(a);if("number"==typeof e){if(0===e)return;a.interval=e}if(Raffler.divIntervalValue.text(e),4!==a.stage&&a.items.length){var t=a.items[a.index];if(t.name&&t.affl){var r="";r+="<div class='itemName'>"+t.name+"</div>\n",r+="<div class='itemAffl'>"+t.affl+"</div>",Raffler.divItemsCycle.html(r),$("div#items-graph span").each(function(){a.index===parseInt($(this)[0].id)?$(this).addClass("chosen"):$(this).removeClass("chosen")}),a.index++}else a.index=0}a.index===a.items.length&&(a.index=0),4!==a.stage&&a.loop()}},stop:function(){this.stopped=!0,window.clearTimeout(this.timeout)},start:function(){return this.stopped=!1,this.loop()},loop:function(){return this.timeout=window.setTimeout(this.runLoop,this.interval),this}};return a.start()}},window.countdownTimer=Raffler.timer(function(){var e=this.interval;if(this.startCountdown&&(this.interval>150&&this.interval<=250&&(this.stage=Raffler.stages.SLOWED,Raffler.divStageValue.text(this.stage),Raffler.ckOptResize.is(":checked")&&(Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level2"),Raffler.body.removeClass(),Raffler.body.addClass("level2"))),this.interval>250&&this.interval<=325&&(this.stage=Raffler.stages.SLOWEST,Raffler.divStageValue.text(this.stage),Raffler.ckOptResize.is(":checked")&&(Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level3"),Raffler.body.removeClass(),Raffler.body.addClass("level3"))),this.interval>325)){if(this.mult=Raffler.initMult,this.interval>350&&(this.mult=this.mult++),!(this.interval>=Raffler.lastInterval)){var t=e+this.mult;return Raffler.divIntervalRange.val(t),t}this.stage=Raffler.stages.DONE,Raffler.divStageValue.text(this.stage),this.startCountdown=!1,this.stop(),Raffler.ckOptResize.is(":checked")&&Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level-win"),Raffler.body.addClass("level4"),Raffler._playSound("victory"),Raffler._enableChosenConfirm(),Raffler.timesRun++,Raffler.divTimesRunValue.text(Raffler.timesRun)}if(!this.startCountdown||this.stage!==Raffler.stages.INIT&&this.stage!==Raffler.stages.BEGUN||(this.stage=Raffler.stages.BEGUN,Raffler.divStageValue.text(this.stage),Raffler.divItemsCycle.hasClass("level1")||Raffler.divItemsCycle.addClass("level1"),Raffler._playSound("beep")),this.stage>Raffler.stages.INIT&&this.stage!==Raffler.stages.DONE){var a=e+(1.5^this.mult++);return Raffler.divMultiplyValue.text(this.mult),Raffler.divIntervalRange.val(a),a}},Raffler.initInterval),Raffler.raffleButtonSmash=function(){if(Raffler._disableRaffle(),Raffler.ckOptResize.is(":checked")?Raffler.divItemsCycle.removeClass():(Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level4")),Raffler.itemsArr.length>1&&(window.countdownTimer.interval=Raffler.initInterval,window.countdownTimer.index=Math.floor(Math.random()*Raffler.itemsArr.length),window.countdownTimer.stage=Raffler.stages.INIT,Raffler.divStageValue.text(this.stage),window.countdownTimer.startCountdown=!0,window.countdownTimer.mult=1,window.countdownTimer.start()),1===Raffler.itemsArr.length){Raffler._notify("Only one item to raffle!<br /><strong>instant winner!</strong>","warning",!0),Raffler.shouldIgnoreSound=!0;var e="";if(e+="<div class='itemName'>"+Raffler.itemsArr[0].name+"</div>\n",e+="<div class='itemAffl'>"+Raffler.itemsArr[0].affl+"</div>",Raffler.divItemsCycle.html(e),Raffler.divItemsCycle.addClass("level4"),Raffler.lastItemChosen={name:$("div.itemName").text(),affl:$("div.itemAffl").text()},Raffler.ckOptResize.is(":checked")&&Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level-win"),Raffler.body.addClass("level4"),Raffler._playSound("victory"),""!==Raffler.lastItemChosen){Raffler.addChosenItemToLocalStorage(Raffler.lastItemChosen),Raffler.refreshChosenItemsDisplay(),Raffler.refreshResultsCount();for(var t=Raffler.lastItemChosen,a=Raffler.itemsArr,r=0;r<a.length;r++)if(a[r].name===t.name&&a[r].affl===t.affl){a.splice(r,1),Raffler.itemsLeftArr=a,Raffler.refreshItemsGraph(Raffler.itemsLeftArr),Raffler.refreshAvailableItemsDisplay();break}}Raffler._notify("Raffled successfully! "+Raffler.lastItemChosen.name+" chosen!","success"),Raffler.timesRun++,Raffler.divTimesRunValue.text(Raffler.timesRun)}Raffler.refreshDebugValues()},Raffler.continueRaffling=function(){if(Raffler.lastItemChosenConfirmed)if(Raffler.lastItemChosen={name:$("div.itemName").text(),affl:$("div.itemAffl").text()},""!==Raffler.lastItemChosen){Raffler.addChosenItemToLocalStorage(Raffler.lastItemChosen),Raffler.refreshChosenItemsDisplay(),Raffler.refreshResultsCount();for(var e=Raffler.lastItemChosen,t=Raffler.itemsArr,a=0;a<t.length;a++)if(t[a].name===e.name&&t[a].affl===e.affl){t.splice(a,1),Raffler.itemsLeftArr=t,Raffler.refreshItemsGraph(Raffler.itemsLeftArr),Raffler.refreshAvailableItemsDisplay();break}Raffler._notify("Raffled successfully! "+Raffler.lastItemChosen.name+" chosen!","success")}else Raffler._notify("Choice could not be made. Pool of choices unchanged.","warning");Raffler._disableChosenConfirm(),Raffler._enableRaffle(),window.countdownTimer.interval=Raffler.initInterval,window.countdownTimer.mult=1,window.countdownTimer.stage=Raffler.stages.INIT,window.countdownTimer.index=Math.floor(Math.random()*Raffler.itemsArr.length),Raffler.divIntervalRange.val(parseInt(Raffler.initInterval)),Raffler.divIntervalValue.text(Raffler.divIntervalRange.val()),Raffler.divStageValue.text(this.stage),Raffler.ckOptResize.is(":checked")?(Raffler.body.removeClass(),Raffler.divItemsCycle.removeClass()):(Raffler.body.addClass("level4"),Raffler.divItemsCycle.removeClass(),Raffler.divItemsCycle.addClass("level4")),Raffler.refreshDebugValues(),window.countdownTimer.startCountdown=!1,window.countdownTimer.start()},Raffler.initApp();